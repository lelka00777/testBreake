<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–Ω—Ç—Ä–æ–ª—å –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 10px;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 0 12px rgba(0, 0, 0, 0.1);
            padding: 12px;
            overflow-x: auto;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #eee;
            font-size: 1.4rem;
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 12px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .input-group {
            width: 100%;
        }
        
        label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.85rem;
        }
        
        input, select, button {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: 600;
            padding: 10px;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .timeline-container {
            overflow-x: auto;
            margin-bottom: 15px;
            -webkit-overflow-scrolling: touch;
        }
        
        /* –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –ú–ê–°–®–¢–ê–ë–ê: –í–µ—Ä–Ω—É–ª–∏ —à–∏—Ä–∏–Ω—É –∫–æ–ª–æ–Ω–∫–∏ */
        .timeline-header {
            display: flex;
            height: 30px;
            margin-left: 150px; 
            min-width: max-content;
        }
        
        /* –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –ú–ê–°–®–¢–ê–ë–ê: –í–µ—Ä–Ω—É–ª–∏ —à–∏—Ä–∏–Ω—É –∫–æ–ª–æ–Ω–∫–∏ */
        .timeline-footer {
            display: flex;
            height: 30px;
            margin-left: 150px;
            min-width: max-content;
            margin-top: 5px;
        }
        
        /* –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –ú–ê–°–®–¢–ê–ë–ê: –í–µ—Ä–Ω—É–ª–∏ —à–∏—Ä–∏–Ω—É —è—á–µ–π–∫–∏ (30px) */
        .time-slot {
            flex: 0 0 30px;
            text-align: center;
            padding: 6px 0;
            /* –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è HH:MM */
            font-size: 0.65rem; 
            border-left: 1px solid #ddd;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 30px;
        }
        
        .employee-row {
            display: flex;
            min-height: 50px;
            margin-bottom: 8px;
            border-bottom: 1px solid #eee;
            min-width: max-content;
        }
        
        /* –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –ú–ê–°–®–¢–ê–ë–ê: –í–µ—Ä–Ω—É–ª–∏ —à–∏—Ä–∏–Ω—É –∫–æ–ª–æ–Ω–∫–∏ (150px) */
        .employee-info {
            flex: 0 0 150px;
            padding: 6px;
            background: #ecf0f1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border-right: 2px solid #bdc3c7;
            min-width: 150px;
            position: sticky;
            left: 0;
            z-index: 2;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –∏–Ω–ø—É—Ç-–ø–æ–ª—è, –∫–æ–≥–¥–∞ –≤–∫–ª—é—á–µ–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ */
        .employee-info input[type="text"] {
            padding: 3px;
            border: 1px solid #3498db;
            border-radius: 3px;
            font-size: inherit;
        }
        
        .employee-name {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 2px;
            cursor: pointer; /* –î–ª—è click */
        }
        
        .employee-position {
            font-size: 0.75rem;
            color: #7f8c8d;
            cursor: pointer; /* –î–ª—è click */
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ */
        .employee-work-hours {
            font-size: 0.75rem;
            color: #3498db; 
            font-weight: 600;
            margin-bottom: 6px;
        }

        .employee-total-breaks {
            font-size: 0.75rem;
            color: #e74c3c; 
            font-weight: 600;
            margin-bottom: 6px;
        }
        
        .time-cells {
            display: flex;
            flex: 1;
            min-width: max-content;
        }
        
        /* –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –ú–ê–°–®–¢–ê–ë–ê: –í–µ—Ä–Ω—É–ª–∏ —à–∏—Ä–∏–Ω—É —è—á–µ–π–∫–∏ (30px) */
        .time-cell {
            flex: 0 0 30px;
            border: 1px solid #ddd;
            border-left: none;
            /* **–ë–õ–ï–î–ù–û-–°–ò–ù–ò–ô**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ù–ï–†–ê–ë–û–ß–ï–ì–û –≤—Ä–µ–º–µ–Ω–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ */
            background: #f0f8ff; 
            transition: background 0.2s;
            min-width: 30px;
        }

        /* **–ù–ê–°–´–©–ï–ù–ù–´–ô –°–ò–ù–ò–ô**: –†–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ */
        .time-cell.working-time-cell {
            background: #3498db; 
            background: linear-gradient(to right, #3498db, #4aa8de);
        }
        
        .time-cell.break {
            background: #e74c3c; /* Base Break Color - –ö—Ä–∞—Å–Ω—ã–π */
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã—Ö –∑–æ–Ω */
        .time-cell.conflict {
            background: #c0392b; /* Darker red for 2+ simultaneous breaks */
            border: 1px dashed #fff !important; 
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 12px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.85rem;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }
        
        .working-time {
            /* –ù–∞—Å—ã—â–µ–Ω–Ω—ã–π —Å–∏–Ω–∏–π */
            background: #3498db; 
            border: 1px solid #ddd;
        }

        .non-working-time {
            /* –ë–ª–µ–¥–Ω–æ-—Å–∏–Ω–∏–π */
            background: #f0f8ff;
            border: 1px solid #ddd;
        }
        
        .break-time {
            background: #e74c3c;
        }
        
        .conflict-time {
            background: #c0392b;
            border: 1px dashed #fff;
        }
        
        .employee-controls {
            display: flex;
            gap: 6px;
            flex-direction: column;
        }
        
        .employee-controls button {
            padding: 5px;
            font-size: 0.7rem;
        }
        
        .show-breaks-btn {
            background: #9b59b6;
        }
        
        .show-breaks-btn:hover {
            background: #8e44ad;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ "–ò–∑–º–µ–Ω–∏—Ç—å" —É–¥–∞–ª–µ–Ω–∞ */
        
        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }
        
        .action-buttons button {
            flex: 1;
            min-width: 140px;
        }
        
        .view-schedule {
            background: #27ae60;
        }
        
        .view-schedule:hover {
            background: #219653;
        }
        
        .clear-data {
            background: #e74c3c;
        }
        
        .clear-data:hover {
            background: #c0392b;
        }
        
        .data-menu {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        
        .menu-btn {
            background: #9b59b6;
            position: relative;
            padding-right: 30px;
        }
        
        .menu-btn:hover {
            background: #8e44ad;
        }
        
        .menu-btn::after {
            content: "‚ñæ";
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
        }
        
        .dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            margin-top: 5px;
        }
        
        .dropdown.show {
            display: block;
        }
        
        .dropdown button {
            background: none;
            color: #333;
            border: none;
            border-bottom: 1px solid #eee;
            border-radius: 0;
            text-align: left;
            padding: 12px 15px;
            font-weight: normal;
        }
        
        .dropdown button:hover {
            background: #f8f9fa;
            color: #2c3e50;
        }
        
        .dropdown button:last-child {
            border-bottom: none;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }
        
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
            max-height: 90%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
            width: auto;
        }
        
        .breaks-list {
            margin-top: 10px;
            overflow-y: auto;
            max-height: 300px;
        }
        
        .break-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .break-actions {
            display: flex;
            gap: 5px;
        }
        
        .break-actions button {
            padding: 4px 8px;
            font-size: 0.7rem;
        }
        
        .total-breaks {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
            font-weight: bold;
        }
        
        .add-break-form {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .form-row .input-group {
            flex: 1;
        }
        
        .pdf-view {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 1001;
            overflow: hidden;
            flex-direction: column;
        }
        
        .pdf-header {
            text-align: center;
            margin-bottom: 15px;
            padding: 15px 10px 10px 10px;
            border-bottom: 2px solid #eee;
            flex-shrink: 0;
        }
        
        .pdf-timeline-container {
            width: 100%;
            flex: 1;
            overflow: auto;
            padding: 0 10px;
        }
        
        /* –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –ú–ê–°–®–¢–ê–ë–ê PDF */
        .pdf-timeline-header {
            display: flex;
            height: 25px;
            margin-left: 150px; 
            min-width: max-content;
        }
        
        .pdf-timeline-footer {
            display: flex;
            height: 25px;
            margin-left: 150px;
            min-width: max-content;
            margin-top: 5px;
        }
        
        .pdf-time-slot {
            flex: 0 0 30px; 
            text-align: center;
            padding: 4px 0;
            /* –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è HH:MM */
            font-size: 0.6rem;
            border-left: 1px solid #ddd;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 30px;
        }
        
        .pdf-employee-row {
            display: flex;
            min-height: 45px;
            margin-bottom: 6px;
            min-width: max-content;
        }
        
        .pdf-employee-info {
            flex: 0 0 150px;
            padding: 4px;
            background: #ecf0f1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border-right: 2px solid #bdc3c7;
            font-size: 0.8rem;
            min-width: 150px;
            position: sticky;
            left: 0;
            z-index: 2;
        }
        
        .pdf-time-cells {
            display: flex;
            flex: 1;
            min-width: max-content;
        }
        
        .pdf-time-cell {
            flex: 0 0 30px;
            border: 1px solid #ddd;
            border-left: none;
            /* –ë–ª–µ–¥–Ω–æ-—Å–∏–Ω–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è –ù–µ—Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –≤ PDF */
            background: #f0f8ff;
            min-width: 30px;
        }

        /* –ù–∞—Å—ã—â–µ–Ω–Ω—ã–π —Å–∏–Ω–∏–π –¥–ª—è —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –≤ PDF */
        .pdf-time-cell.working-time-cell {
            background: #3498db; 
            background: linear-gradient(to right, #3498db, #4aa8de);
        }
        
        .pdf-time-cell.break {
            background: #e74c3c;
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã—Ö –∑–æ–Ω –≤ PDF */
        .pdf-time-cell.conflict {
            background: #c0392b; 
            border: 1px dashed #fff !important;
        }

        .pdf-close {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 1002;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .share-container {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 15px 0;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            flex-wrap: wrap;
            flex-shrink: 0;
        }
        
        .share-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: background 0.3s;
            width: 55px;
            height: 55px;
        }
        
        .share-btn:hover {
            background: #e8f4fc;
        }
        
        .share-icon {
            width: 25px;
            height: 25px;
            margin-bottom: 4px;
        }
        
        .share-text {
            font-size: 0.65rem;
            color: #2c3e50;
        }
        
        .preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1003;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .preview-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            text-align: center;
        }
        
        .preview-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .preview-buttons button {
            width: auto;
            padding: 10px 20px;
        }
        
        @media (max-width: 480px) {
            /* –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –ú–ê–°–®–¢–ê–ë–ê –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
            .time-slot, .time-cell {
                flex: 0 0 28px;
                min-width: 28px;
                font-size: 0.6rem;
            }
            
            .employee-info {
                flex: 0 0 120px; 
                min-width: 120px;
            }

            .timeline-header, .timeline-footer {
                margin-left: 120px; 
            }
            
            .employee-name {
                font-size: 0.8rem;
            }
            
            .employee-position {
                font-size: 0.7rem;
            }
            
            .pdf-time-slot, .pdf-time-cell {
                flex: 0 0 28px;
                min-width: 28px;
                font-size: 0.6rem;
            }
            
            .pdf-employee-info {
                flex: 0 0 120px;
                min-width: 120px;
                font-size: 0.7rem;
            }
            
            .pdf-timeline-header, .pdf-timeline-footer {
                margin-left: 120px;
            }
            
            .share-btn {
                width: 50px;
                height: 50px;
            }
            
            .share-icon {
                width: 22px;
                height: 22px;
            }
            
            .action-buttons button {
                min-width: 120px;
            }
        }
        
        @media (orientation: landscape) {
            .pdf-timeline-container {
                transform: scale(0.85);
                transform-origin: top center;
            }
        }
        
        @media (orientation: portrait) {
            .pdf-timeline-container {
                transform: scale(0.9);
                transform-origin: top center;
            }
        }
        
        .export-container {
            width: 100%;
            overflow: auto;
        }
        
        .file-input {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–ö–æ–Ω—Ç—Ä–æ–ª—å –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h1>
        
        <div class="controls">
            <p style="font-size: 0.75rem; color: #7f8c8d; margin-bottom: 5px;">* –≠—Ç–∏ –ø–æ–ª—è –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç **–æ–±—â—É—é –æ–±–ª–∞—Å—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è** —Ç–∞–π–º–ª–∞–π–Ω–∞.</p>
            <div class="input-group-row" style="display: flex; gap: 10px;">
                <div class="input-group" style="flex: 1;">
                    <label for="shiftStart">–ù–∞—á–∞–ª–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ç–∞–π–º–ª–∞–π–Ω–∞</label>
                    <input type="time" id="shiftStart" step="900" value="09:45">
                </div>
                <div class="input-group" style="flex: 1;">
                    <label for="shiftEnd">–ö–æ–Ω–µ—Ü –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ç–∞–π–º–ª–∞–π–Ω–∞</label>
                    <input type="time" id="shiftEnd" step="900" value="22:45">
                </div>
            </div>
            
            <div class="input-group">
                <label for="employeeName">–ò–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</label>
                <input type="text" id="employeeName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
            </div>
            
            <div class="input-group">
                <label for="employeePosition">–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
                <input type="text" id="employeePosition" placeholder="–í–≤–µ–¥–∏—Ç–µ –¥–æ–ª–∂–Ω–æ—Å—Ç—å">
            </div>

            <div class="input-group-row" style="display: flex; gap: 10px;">
                <div class="input-group" style="flex: 1;">
                    <label for="employeeShiftStart">–ù–∞—á–∞–ª–æ —Å–º–µ–Ω—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</label>
                    <input type="time" id="employeeShiftStart" step="900" value="09:45">
                </div>
                <div class="input-group" style="flex: 1;">
                    <label for="employeeShiftEnd">–ö–æ–Ω–µ—Ü —Å–º–µ–Ω—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</label>
                    <input type="time" id="employeeShiftEnd" step="900" value="22:45">
                </div>
            </div>
            
            <div class="input-group">
                <label>&nbsp;</label>
                <button id="addEmployee">–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>
            </div>
        </div>
        
        <div class="timeline-container">
            <div class="timeline-header" id="timelineHeader">
                </div>
            
            <div id="employeesContainer">
                </div>
            
            <div class="timeline-footer" id="timelineFooter">
                </div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color working-time"></div>
                <span>–†–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (–ù–∞—Å—ã—â–µ–Ω–Ω–æ-—Å–∏–Ω–∏–π)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color non-working-time"></div>
                <span>–ù–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è (–ë–ª–µ–¥–Ω–æ-—Å–∏–Ω–∏–π)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color break-time"></div>
                <span>–ü–µ—Ä–µ—Ä—ã–≤ (–ö—Ä–∞—Å–Ω—ã–π)</span>
            </div>
             <div class="legend-item">
                <div class="legend-color conflict-time"></div>
                <span>–ö–æ–Ω—Ñ–ª–∏–∫—Ç (2+ –ø–µ—Ä–µ—Ä—ã–≤–∞)</span>
            </div>
        </div>
        
        <div class="action-buttons">
            <button class="view-schedule" id="viewSchedule">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≥—Ä–∞—Ñ–∏–∫</button>
            <button class="clear-data" id="clearData">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
            <div class="data-menu">
                <button class="menu-btn" id="dataMenuBtn">‚ñæ –î–∞–Ω–Ω—ã–µ</button>
                <div class="dropdown" id="dataDropdown">
                    <button onclick="exportToJSON()">üì§ –≠–∫—Å–ø–æ—Ä—Ç JSON</button>
                    <button onclick="importJSON()">üì• –ò–º–ø–æ—Ä—Ç JSON</button>
                    <button onclick="copySchedule('brief')">üìã –ö—Ä–∞—Ç–∫–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</button>
                    <button onclick="copySchedule('detailed')">üìä –î–µ—Ç–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</button>
                </div>
            </div>
        </div>
        
        <div class="modal" id="previewModal">
            <div class="modal-content preview-content">
                <h2>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç</h2>
                <p id="previewText"></p>
                <div class="preview-buttons">
                    <button id="confirmActionButton">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                    <button class="clear-data" onclick="closePreviewModal()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <div class="modal" id="editModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h2>
                    <button class="close-modal" onclick="closeEditModal()">√ó</button>
                </div>
                <div class="input-group">
                    <label for="editEmployeeName">–ò–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</label>
                    <input type="text" id="editEmployeeName">
                </div>
                <div class="input-group">
                    <label for="editEmployeePosition">–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
                    <input type="text" id="editEmployeePosition">
                </div>
                <div class="input-group-row" style="display: flex; gap: 10px;">
                    <div class="input-group" style="flex: 1;">
                        <label for="editEmployeeShiftStart">–ù–∞—á–∞–ª–æ —Å–º–µ–Ω—ã</label>
                        <input type="time" id="editEmployeeShiftStart" step="900">
                    </div>
                    <div class="input-group" style="flex: 1;">
                        <label for="editEmployeeShiftEnd">–ö–æ–Ω–µ—Ü —Å–º–µ–Ω—ã</label>
                        <input type="time" id="editEmployeeShiftEnd" step="900">
                    </div>
                </div>
                <button id="saveEmployeeEditBtn" style="margin-top: 15px;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                <button id="removeEmployeeBtn" class="clear-data" style="margin-top: 10px;">–£–¥–∞–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>
            </div>
        </div>

        <div class="modal" id="breaksModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="breaksModalTitle">–ü–µ—Ä–µ—Ä—ã–≤—ã</h2>
                    <button class="close-modal" onclick="closeBreaksModal()">√ó</button>
                </div>
                
                <div class="employee-total-breaks" id="totalBreakTime"></div>
                
                <div class="breaks-list" id="breaksList">
                    </div>

                <div class="add-break-form">
                    <h3>–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ—Ä—ã–≤ (15 –º–∏–Ω)</h3>
                    <div class="form-row">
                        <div class="input-group">
                            <label for="breakStart">–ù–∞—á–∞–ª–æ</label>
                            <input type="time" id="breakStart" step="900" value="12:00">
                        </div>
                        <div class="input-group">
                            <label for="breakDuration">–ü—Ä–æ–¥–æ–ª–∂-—Ç—å (–º–∏–Ω)</label>
                            <select id="breakDuration">
                                <option value="15">15</option>
                                <option value="30">30</option>
                                <option value="45">45</option>
                                <option value="60">60</option>
                            </select>
                        </div>
                    </div>
                    <button id="addBreakBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
            </div>
        </div>
        
        <input type="file" id="jsonFileInput" class="file-input" accept=".json">

    </div>

    <div class="pdf-view" id="pdfView">
        <button class="pdf-close" id="pdfClose">√ó</button>
        <div class="pdf-header">
            <h2>–ì—Ä–∞—Ñ–∏–∫ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h2>
            <p id="pdfDate"></p>
        </div>
        
        <div class="share-container">
             <button class="share-btn" onclick="showPreview('telegram')">
                <svg class="share-icon" viewBox="0 0 24 24" fill="#0088cc">
                    <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.447 1.394c-.16.160-.295.295-.605.295l.213-3.053 5.56-5.022c.242-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.652-.64.136-.954l11.566-4.458c.538-.196 1.006.128.832.941z"/>
                </svg>
                <span class="share-text">Telegram</span>
            </button>
            <button class="share-btn" onclick="showPreview('whatsapp')">
                <svg class="share-icon" viewBox="0 0 24 24" fill="#25D366">
                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.150-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.864 3.488"/>
                </svg>
                <span class="share-text">WhatsApp</span>
            </button>
            <button class="share-btn" onclick="showPreview('pdf')">
                <svg class="share-icon" viewBox="0 0 24 24" fill="#E74C3C">
                    <path d="M18 2h-8L4 8v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2zm-2 10h-3v4h-2v-4H8l4-4 4 4z"/>
                </svg>
                <span class="share-text">PDF</span>
            </button>
            <button class="share-btn" onclick="showPreview('image')">
                 <svg class="share-icon" viewBox="0 0 24 24" fill="#3498db">
                    <path d="M5 19h14v-6.5l-3.5 3.5-3.5-3.5-3.5 3.5L5 12.5V19zM19 5H5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2zm-4.86 8.86l-3 3-2.14-2.14L3 17V7a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10l-3.5-3.5-2.64-2.64z"/>
                </svg>
                <span class="share-text">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</span>
            </button>
        </div>
        
        <div class="pdf-timeline-container" id="pdfTimelineContainer">
            </div>
        <canvas id="pdfCanvas" style="display:none;"></canvas>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let employees = [];
        let workStart = new Date(); // –ù–∞—á–∞–ª–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ç–∞–π–º–ª–∞–π–Ω–∞
        let workEnd = new Date();   // –ö–æ–Ω–µ—Ü –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ç–∞–π–º–ª–∞–π–Ω–∞
        let selectedEmployeeId = null; 
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const addEmployeeBtn = document.getElementById('addEmployee');
        const employeeNameInput = document.getElementById('employeeName');
        const employeePositionInput = document.getElementById('employeePosition');
        const employeeShiftStartInput = document.getElementById('employeeShiftStart');
        const employeeShiftEndInput = document.getElementById('employeeShiftEnd');
        const employeesContainer = document.getElementById('employeesContainer');
        const timelineHeader = document.getElementById('timelineHeader');
        const timelineFooter = document.getElementById('timelineFooter');
        const viewScheduleBtn = document.getElementById('viewSchedule');
        const clearDataBtn = document.getElementById('clearData');
        const shiftStartInput = document.getElementById('shiftStart');
        const shiftEndInput = document.getElementById('shiftEnd');

        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –∏ –∏—Ö —ç–ª–µ–º–µ–Ω—Ç—ã
        const editModal = document.getElementById('editModal');
        const breaksModal = document.getElementById('breaksModal');
        const editEmployeeNameInput = document.getElementById('editEmployeeName');
        const editEmployeePositionInput = document.getElementById('editEmployeePosition');
        const editEmployeeShiftStartInput = document.getElementById('editEmployeeShiftStart');
        const editEmployeeShiftEndInput = document.getElementById('editEmployeeShiftEnd');
        const saveEmployeeEditBtn = document.getElementById('saveEmployeeEditBtn');
        const removeEmployeeBtn = document.getElementById('removeEmployeeBtn');
        const breaksList = document.getElementById('breaksList');
        const addBreakBtn = document.getElementById('addBreakBtn');
        const breakStartInput = document.getElementById('breakStart');
        const breakDurationSelect = document.getElementById('breakDuration');
        const totalBreakTimeElement = document.getElementById('totalBreakTime');

        // –≠–ª–µ–º–µ–Ω—Ç—ã –º–µ–Ω—é –¥–∞–Ω–Ω—ã—Ö
        const dataMenuBtn = document.getElementById('dataMenuBtn');
        const dataDropdown = document.getElementById('dataDropdown');
        const jsonFileInput = document.getElementById('jsonFileInput');
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã PDF View
        const pdfView = document.getElementById('pdfView');
        const pdfCloseBtn = document.getElementById('pdfClose');
        const pdfTimelineContainer = document.getElementById('pdfTimelineContainer');
        const pdfDateElement = document.getElementById('pdfDate');

        // –≠–ª–µ–º–µ–Ω—Ç—ã Preview Modal
        const previewModal = document.getElementById('previewModal');
        const previewText = document.getElementById('previewText');
        const confirmActionButton = document.getElementById('confirmActionButton');
        let currentAction = null; // –•—Ä–∞–Ω–∏—Ç –¥–µ–π—Å—Ç–≤–∏–µ (telegram, whatsapp, pdf, image)

        // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º ---

        /**
         * –ü–∞—Ä—Å–∏—Ç —Å—Ç—Ä–æ–∫—É –≤—Ä–µ–º–µ–Ω–∏ "HH:MM" –≤ –æ–±—ä–µ–∫—Ç Date.
         * @param {string} timeStr - –í—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ "HH:MM".
         * @returns {Date} –û–±—ä–µ–∫—Ç Date —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º.
         */
        function parseTime(timeStr) {
            const now = new Date();
            if (!timeStr) return now;
            const [hours, minutes] = timeStr.split(':').map(Number);
            now.setHours(hours, minutes, 0, 0);
            return now;
        }

        /**
         * –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç Date –≤ —Å—Ç—Ä–æ–∫—É –≤—Ä–µ–º–µ–Ω–∏ "HH:MM".
         * @param {Date} date - –û–±—ä–µ–∫—Ç Date.
         * @returns {string} –í—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ "HH:MM".
         */
        function formatTime(date) {
            return date.toTimeString().slice(0, 5);
        }

        /**
         * –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ–±—â–µ–µ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≤ –º–∏–Ω—É—Ç–∞—Ö.
         * @param {Object} employee - –û–±—ä–µ–∫—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.
         * @returns {number} –û–±—â–µ–µ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ –≤ –º–∏–Ω—É—Ç–∞—Ö.
         */
        function calculateTotalBreakDuration(employee) {
            return employee.breaks.reduce((total, br) => {
                const durationMs = br.end.getTime() - br.start.getTime();
                return total + Math.round(durationMs / (1000 * 60)); // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –º–∏–Ω—É—Ç–∞—Ö
            }, 0);
        }

        /**
         * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –ø–µ—Ä–µ—Ä—ã–≤ –≤ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è.
         * @param {Date} breakStart - –ù–∞—á–∞–ª–æ –ø–µ—Ä–µ—Ä—ã–≤–∞.
         * @param {Date} breakEnd - –ö–æ–Ω–µ—Ü –ø–µ—Ä–µ—Ä—ã–≤–∞.
         * @param {Date} shiftStart - –ù–∞—á–∞–ª–æ —Å–º–µ–Ω—ã.
         * @param {Date} shiftEnd - –ö–æ–Ω–µ—Ü —Å–º–µ–Ω—ã.
         * @returns {boolean} True, –µ—Å–ª–∏ –ø–µ—Ä–µ—Ä—ã–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–º–µ–Ω–µ.
         */
        function isBreakInShift(breakStart, breakEnd, shiftStart, shiftEnd) {
             // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ –ø–µ—Ä–µ—Ä—ã–≤ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–µ —Ä–∞–Ω—å—à–µ –Ω–∞—á–∞–ª–∞ —Å–º–µ–Ω—ã
            const startsAfterShiftStart = breakStart.getTime() >= shiftStart.getTime();
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ –ø–µ—Ä–µ—Ä—ã–≤ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–µ –ø–æ–∑–∂–µ –∫–æ–Ω—Ü–∞ —Å–º–µ–Ω—ã
            const endsBeforeShiftEnd = breakEnd.getTime() <= shiftEnd.getTime();
            
            return startsAfterShiftStart && endsBeforeShiftEnd;
        }

        // --- –õ–æ–≥–∏–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö ---

        /**
         * –û–±–Ω–æ–≤–ª—è–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ workStart/workEnd –∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç —Ç–∞–π–º–ª–∞–π–Ω.
         * @param {boolean} shouldRender - –§–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π, –Ω—É–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫.
         */
        function updateShiftTimes(shouldRender = true) {
            const startStr = shiftStartInput.value;
            const endStr = shiftEndInput.value;

            workStart = parseTime(startStr);
            workEnd = parseTime(endStr);
            
            // –ï—Å–ª–∏ –∫–æ–Ω–µ—Ü —Å–º–µ–Ω—ã —Ä–∞–Ω—å—à–µ –Ω–∞—á–∞–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 23:00 - 07:00), 
            // –ø–µ—Ä–µ–Ω–æ—Å–∏–º workEnd –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
            if (workEnd.getTime() <= workStart.getTime()) {
                workEnd.setDate(workEnd.getDate() + 1);
            }
            
            if (shouldRender) {
                saveToLocalStorage();
                generateTimelineHeaders();
                renderEmployees();
            }
        }
        
        /**
         * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ (—à–∫–∞–ª—É) —Ç–∞–π–º–ª–∞–π–Ω–∞.
         */
        function generateTimelineHeaders() {
            timelineHeader.innerHTML = '';
            timelineFooter.innerHTML = '';

            const totalMinutes = (workEnd.getTime() - workStart.getTime()) / (1000 * 60);
            const numSlots = totalMinutes / 15; // 15-–º–∏–Ω—É—Ç–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã

            let currentTime = new Date(workStart);

            for (let i = 0; i < numSlots; i++) {
                const isHourMark = currentTime.getMinutes() === 0;
                // –ò–ó–ú–ï–ù–ï–ù–ò–ï: –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Ä–µ–º—è –≤ –ö–ê–ñ–î–û–ú 15-–º–∏–Ω—É—Ç–Ω–æ–º —Å–ª–æ—Ç–µ
                const timeText = formatTime(currentTime);
                
                // Header
                const headerSlot = document.createElement('div');
                headerSlot.className = 'time-slot';
                headerSlot.textContent = timeText; // <-- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º HH:MM
                headerSlot.style.borderLeft = isHourMark ? '2px solid #aaa' : '1px solid #ddd';
                timelineHeader.appendChild(headerSlot);
                
                // Footer (–¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è)
                const footerSlot = document.createElement('div');
                footerSlot.className = 'time-slot';
                footerSlot.textContent = timeText; // <-- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º HH:MM
                footerSlot.style.borderLeft = isHourMark ? '2px solid #aaa' : '1px solid #ddd';
                timelineFooter.appendChild(footerSlot);

                // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É 15-–º–∏–Ω—É—Ç–Ω–æ–º—É –∏–Ω—Ç–µ—Ä–≤–∞–ª—É
                currentTime.setMinutes(currentTime.getMinutes() + 15);
            }
            
            // –¢–∞–∫–∂–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è PDF
            generatePdfTimelineHeaders();
        }

        /**
         * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è PDF-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è.
         */
        function generatePdfTimelineHeaders() {
            pdfTimelineContainer.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞ –ø–µ—Ä–µ–¥ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º
            
            // –°–æ–∑–¥–∞–µ–º —à–∞–ø–∫—É
            const headerDiv = document.createElement('div');
            headerDiv.className = 'pdf-timeline-header';
            
            const totalMinutes = (workEnd.getTime() - workStart.getTime()) / (1000 * 60);
            const numSlots = totalMinutes / 15;

            let currentTime = new Date(workStart);

            for (let i = 0; i < numSlots; i++) {
                const isHourMark = currentTime.getMinutes() === 0;
                // –ò–ó–ú–ï–ù–ï–ù–ò–ï: –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Ä–µ–º—è –≤ –ö–ê–ñ–î–û–ú 15-–º–∏–Ω—É—Ç–Ω–æ–º —Å–ª–æ—Ç–µ
                const timeText = formatTime(currentTime);
                
                const headerSlot = document.createElement('div');
                headerSlot.className = 'pdf-time-slot';
                headerSlot.textContent = timeText; // <-- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º HH:MM
                headerSlot.style.borderLeft = isHourMark ? '2px solid #aaa' : '1px solid #ddd';
                headerDiv.appendChild(headerSlot);

                currentTime.setMinutes(currentTime.getMinutes() + 15);
            }

            pdfTimelineContainer.appendChild(headerDiv);
        }

        /**
         * –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏ –∏—Ö –≥—Ä–∞—Ñ–∏–∫–∏.
         */
        function renderEmployees() {
            employeesContainer.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

            // 1. –°—á–∏—Ç–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
            const conflictMap = calculateBreakConflicts();

            // 2. –†–µ–Ω–¥–µ—Ä–∏–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
            employees.forEach(employee => {
                const employeeRow = document.createElement('div');
                employeeRow.className = 'employee-row';
                employeeRow.dataset.employeeId = employee.id;
                
                // --- –ö–æ–ª–æ–Ω–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–µ (Sticky) ---
                const infoDiv = document.createElement('div');
                infoDiv.className = 'employee-info';
                
                const nameSpan = document.createElement('div');
                nameSpan.className = 'employee-name';
                nameSpan.textContent = employee.name;
                nameSpan.onclick = () => openEditModal(employee.id); // –ö–ª–∏–∫ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                
                const positionSpan = document.createElement('div');
                positionSpan.className = 'employee-position';
                positionSpan.textContent = employee.position;
                positionSpan.onclick = () => openEditModal(employee.id); // –ö–ª–∏–∫ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                
                const workHoursSpan = document.createElement('div');
                workHoursSpan.className = 'employee-work-hours';
                workHoursSpan.textContent = `${formatTime(employee.shiftStart)} - ${formatTime(employee.shiftEnd)}`;

                const totalBreaksSpan = document.createElement('div');
                totalBreaksSpan.className = 'employee-total-breaks';
                const totalDuration = calculateTotalBreakDuration(employee);
                totalBreaksSpan.textContent = `–ü–µ—Ä–µ—Ä—ã–≤—ã: ${totalDuration} –º–∏–Ω`;

                const controlsDiv = document.createElement('div');
                controlsDiv.className = 'employee-controls';

                const breaksBtn = document.createElement('button');
                breaksBtn.className = 'show-breaks-btn';
                breaksBtn.textContent = '–£–ø—Ä. –ø–µ—Ä–µ—Ä—ã–≤–∞–º–∏';
                breaksBtn.onclick = () => showBreaks(employee.id);

                controlsDiv.appendChild(breaksBtn);
                
                infoDiv.appendChild(nameSpan);
                infoDiv.appendChild(positionSpan);
                infoDiv.appendChild(workHoursSpan);
                infoDiv.appendChild(totalBreaksSpan);
                infoDiv.appendChild(controlsDiv);
                
                employeeRow.appendChild(infoDiv);

                // --- –Ø—á–µ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ ---
                const cellsDiv = document.createElement('div');
                cellsDiv.className = 'time-cells';
                
                const totalMinutes = (workEnd.getTime() - workStart.getTime()) / (1000 * 60);
                const numSlots = totalMinutes / 15;
                let currentTime = new Date(workStart);
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å–º–µ–Ω—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (—É—á–∏—Ç—ã–≤–∞—è –Ω–æ—á–Ω—ã–µ —Å–º–µ–Ω—ã)
                const employeeShiftEnd = new Date(employee.shiftEnd);
                if (employeeShiftEnd.getTime() <= employee.shiftStart.getTime()) {
                    employeeShiftEnd.setDate(employeeShiftEnd.getDate() + 1);
                }

                for (let i = 0; i < numSlots; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'time-cell';
                    cell.dataset.time = formatTime(currentTime);

                    const intervalStart = new Date(currentTime);
                    currentTime.setMinutes(currentTime.getMinutes() + 15);
                    const intervalEnd = new Date(currentTime);
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞: –†–∞–±–æ—á–µ–µ –ª–∏ –≤—Ä–µ–º—è?
                    const isWorking = intervalStart.getTime() >= employee.shiftStart.getTime() && 
                                      intervalEnd.getTime() <= employeeShiftEnd.getTime();
                    
                    if (isWorking) {
                        cell.classList.add('working-time-cell');
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞: –ü–µ—Ä–µ—Ä—ã–≤ –ª–∏?
                    let isBreak = false;
                    for (const breakItem of employee.breaks) {
                        // –ü–µ—Ä–µ—Ä—ã–≤ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤ –∏–Ω—Ç–µ—Ä–≤–∞–ª–µ –ò–õ–ò –ø–µ—Ä–µ—Ä—ã–≤ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –≤ –∏–Ω—Ç–µ—Ä–≤–∞–ª–µ –ò–õ–ò –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–Ω—É—Ç—Ä–∏ –ø–µ—Ä–µ—Ä—ã–≤–∞
                        if (intervalStart.getTime() < breakItem.end.getTime() && intervalEnd.getTime() > breakItem.start.getTime()) {
                            isBreak = true;
                            break;
                        }
                    }
                    
                    if (isBreak) {
                        cell.classList.add('break');
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞: –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ª–∏?
                    if (conflictMap[intervalStart.getTime()] && conflictMap[intervalStart.getTime()].count > 1) {
                         // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—á–∞—Å—Ç–≤—É–µ—Ç –ª–∏ –¥–∞–Ω–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –≤ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ –≤ —ç—Ç–æ–º —Å–ª–æ—Ç–µ
                        if (conflictMap[intervalStart.getTime()].employees.includes(employee.id)) {
                             cell.classList.add('conflict');
                        }
                    }

                    cellsDiv.appendChild(cell);
                }
                
                employeeRow.appendChild(cellsDiv);
                employeesContainer.appendChild(employeeRow);
            });
            
            saveToLocalStorage(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
        }

        /**
         * –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≤ —Å–ø–∏—Å–æ–∫.
         */
        function addEmployee() {
            const name = employeeNameInput.value.trim();
            const position = employeePositionInput.value.trim();
            const shiftStartStr = employeeShiftStartInput.value;
            const shiftEndStr = employeeShiftEndInput.value;

            if (!name || !shiftStartStr || !shiftEndStr) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ò–º—è, –ù–∞—á–∞–ª–æ –∏ –ö–æ–Ω–µ—Ü —Å–º–µ–Ω—ã.');
                return;
            }

            const newEmployee = {
                id: Date.now(), // –ü—Ä–æ—Å—Ç–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
                name: name,
                position: position,
                shiftStart: parseTime(shiftStartStr),
                shiftEnd: parseTime(shiftEndStr),
                breaks: []
            };

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–æ—á–Ω—É—é —Å–º–µ–Ω—É –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞
            if (newEmployee.shiftEnd.getTime() <= newEmployee.shiftStart.getTime()) {
                newEmployee.shiftEnd.setDate(newEmployee.shiftEnd.getDate() + 1);
            }

            employees.push(newEmployee);
            
            // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, –∫—Ä–æ–º–µ –≤—Ä–µ–º–µ–Ω–∏
            employeeNameInput.value = '';
            employeePositionInput.value = '';
            
            renderEmployees();
        }
        
        /**
         * –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –∫–∞–∂–¥—ã–π 15-–º–∏–Ω—É—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª.
         * @returns {Object} –û–±—ä–µ–∫—Ç, –≥–¥–µ –∫–ª—é—á - —ç—Ç–æ timestamp –Ω–∞—á–∞–ª–∞ 15-–º–∏–Ω. –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞, 
         * –∞ –∑–Ω–∞—á–µ–Ω–∏–µ - {count: number, employees: Array<number>}.
         */
        function calculateBreakConflicts() {
            const conflictMap = {}; // Key: timestamp (15 min interval start), Value: {count, employees}

            const totalMinutes = (workEnd.getTime() - workStart.getTime()) / (1000 * 60);
            const numSlots = totalMinutes / 15;
            let currentTime = new Date(workStart);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø–æ –≤—Å–µ–º —Å–ª–æ—Ç–∞–º
            for (let i = 0; i < numSlots; i++) {
                conflictMap[currentTime.getTime()] = { count: 0, employees: [] };
                currentTime.setMinutes(currentTime.getMinutes() + 15);
            }

            employees.forEach(employee => {
                employee.breaks.forEach(breakItem => {
                    let breakTime = new Date(breakItem.start);
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–µ—Ä–µ—Ä—ã–≤–∞ (—É—á–∏—Ç—ã–≤–∞—è, —á—Ç–æ –æ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–ª–∏–Ω–Ω—ã–º)
                    const breakEndTime = new Date(breakItem.end);
                    
                    // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ 15-–º–∏–Ω—É—Ç–Ω—ã–º —Å–ª–æ—Ç–∞–º –≤ —Ä–∞–º–∫–∞—Ö –ø–µ—Ä–µ—Ä—ã–≤–∞
                    while (breakTime.getTime() < breakEndTime.getTime()) {
                        // –ù–∞—Ö–æ–¥–∏–º –Ω–∞—á–∞–ª–æ 15-–º–∏–Ω—É—Ç–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞, –≤ –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ø–∞–¥–∞–µ—Ç breakTime.
                        // –ï—Å–ª–∏ breakTime –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –Ω–∞—á–∞–ª–æ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞, –±–µ—Ä–µ–º –±–ª–∏–∂–∞–π—à–µ–µ –ø—Ä–æ—à–ª–æ–µ –Ω–∞—á–∞–ª–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞.
                        let slotStart = new Date(breakTime);
                        slotStart.setMinutes(Math.floor(slotStart.getMinutes() / 15) * 15);
                        slotStart.setSeconds(0, 0);
                        
                        // –ï—Å–ª–∏ —ç—Ç–æ—Ç —Å–ª–æ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –æ–±—â–µ–º —Ç–∞–π–º–ª–∞–π–Ω–µ
                        if (slotStart.getTime() >= workStart.getTime() && slotStart.getTime() < workEnd.getTime()) {
                            const key = slotStart.getTime();
                            if (conflictMap[key]) {
                                conflictMap[key].count++;
                                if (!conflictMap[key].employees.includes(employee.id)) {
                                     conflictMap[key].employees.push(employee.id);
                                }
                            }
                        }
                        
                        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É 15-–º–∏–Ω—É—Ç–Ω–æ–º—É –∏–Ω—Ç–µ—Ä–≤–∞–ª—É
                        breakTime.setMinutes(breakTime.getMinutes() + 15);
                        
                        // –í–∞–∂–Ω–æ: –µ—Å–ª–∏ –ø–µ—Ä–µ—Ä—ã–≤ –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–π (–Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π), –Ω—É–∂–Ω–æ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –≤—ã—Ö–æ–¥
                        if (breakTime.getTime() > workEnd.getTime() + (1000 * 60 * 60 * 24)) break; // –ó–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
                    }
                });
            });

            return conflictMap;
        }


        // --- –õ–æ–≥–∏–∫–∞ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω (–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞) ---

        /**
         * –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.
         * @param {number} id - ID —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.
         */
        function openEditModal(id) {
            const employee = employees.find(emp => emp.id === id);
            if (!employee) return;

            selectedEmployeeId = id;
            
            editEmployeeNameInput.value = employee.name;
            editEmployeePositionInput.value = employee.position;
            editEmployeeShiftStartInput.value = formatTime(employee.shiftStart);
            
            // –ï—Å–ª–∏ —Å–º–µ–Ω–∞ –Ω–æ—á–Ω–∞—è, –≤—Ä–µ–º—è –∫–æ–Ω—Ü–∞ —Å–º–µ–Ω—ã –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞. 
            // –û–¥–Ω–∞–∫–æ –≤ –∏–Ω–ø—É—Ç–µ –Ω—É–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Å—Ç–æ –≤—Ä–µ–º—è HH:MM.
            editEmployeeShiftEndInput.value = formatTime(employee.shiftEnd); 
            
            editModal.style.display = 'flex';
        }

        /**
         * –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.
         */
        function closeEditModal() {
            editModal.style.display = 'none';
            selectedEmployeeId = null;
        }

        /**
         * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.
         */
        function saveEmployeeEdit() {
            const employee = employees.find(emp => emp.id === selectedEmployeeId);
            if (!employee) return;
            
            const newName = editEmployeeNameInput.value.trim();
            const newPosition = editEmployeePositionInput.value.trim();
            const newShiftStartStr = editEmployeeShiftStartInput.value;
            const newShiftEndStr = editEmployeeShiftEndInput.value;

            if (!newName || !newShiftStartStr || !newShiftEndStr) {
                 alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ò–º—è, –ù–∞—á–∞–ª–æ –∏ –ö–æ–Ω–µ—Ü —Å–º–µ–Ω—ã.');
                 return;
            }

            employee.name = newName;
            employee.position = newPosition;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞ —Å–º–µ–Ω—ã
            employee.shiftStart = parseTime(newShiftStartStr);
            employee.shiftEnd = parseTime(newShiftEndStr);

            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –¥–ª—è –Ω–æ—á–Ω–æ–π —Å–º–µ–Ω—ã
            if (employee.shiftEnd.getTime() <= employee.shiftStart.getTime()) {
                employee.shiftEnd.setDate(employee.shiftEnd.getDate() + 1);
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ —É–¥–∞–ª—è–µ–º –ø–µ—Ä–µ—Ä—ã–≤—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã—à–ª–∏ –∑–∞ —Ä–∞–º–∫–∏ –Ω–æ–≤–æ–π —Å–º–µ–Ω—ã
            employee.breaks = employee.breaks.filter(br => 
                isBreakInShift(br.start, br.end, employee.shiftStart, employee.shiftEnd)
            );
            
            closeEditModal();
            renderEmployees();
        }
        
        /**
         * –£–¥–∞–ª—è–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.
         */
        function removeEmployee() {
             if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ ${editEmployeeNameInput.value}?`)) {
                employees = employees.filter(emp => emp.id !== selectedEmployeeId);
                closeEditModal();
                renderEmployees();
            }
        }


        // --- –õ–æ–≥–∏–∫–∞ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω (–ü–µ—Ä–µ—Ä—ã–≤—ã) ---

        /**
         * –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ—Ä—ã–≤–∞–º–∏.
         * @param {number} id - ID —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.
         */
        function showBreaks(id) {
            const employee = employees.find(emp => emp.id === id);
            if (!employee) return;

            selectedEmployeeId = id;
            document.getElementById('breaksModalTitle').textContent = `–ü–µ—Ä–µ—Ä—ã–≤—ã: ${employee.name}`;
            renderBreaksList(employee);
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ—Ä—ã–≤–∞: 
            // 1. –ë–µ—Ä–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –≤—Ä–µ–º—è 12:00, –Ω–æ –≤ —Ä–∞–º–∫–∞—Ö —Å–º–µ–Ω—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.
            // 2. –ï—Å–ª–∏ 12:00 –≤–Ω–µ —Å–º–µ–Ω—ã, —Å—Ç–∞–≤–∏–º –Ω–∞—á–∞–ª–æ —Å–º–µ–Ω—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.
            let defaultBreakTime = parseTime('12:00');
            
            // –ï—Å–ª–∏ 12:00 —Ä–∞–Ω—å—à–µ –Ω–∞—á–∞–ª–∞ —Å–º–µ–Ω—ã –ò–õ–ò 12:00 –ø–æ–∑–∂–µ –∫–æ–Ω—Ü–∞ —Å–º–µ–Ω—ã (—Å —É—á–µ—Ç–æ–º –Ω–æ—á–Ω—ã—Ö)
            const employeeShiftEnd = new Date(employee.shiftEnd);
            if (employeeShiftEnd.getTime() <= employee.shiftStart.getTime()) {
                employeeShiftEnd.setDate(employeeShiftEnd.getDate() + 1);
            }

            if (defaultBreakTime.getTime() < employee.shiftStart.getTime() || defaultBreakTime.getTime() > employeeShiftEnd.getTime()) {
                 defaultBreakTime = new Date(employee.shiftStart);
            }

            breakStartInput.value = formatTime(defaultBreakTime);

            breaksModal.style.display = 'flex';
        }

        /**
         * –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ—Ä—ã–≤–∞–º–∏.
         */
        function closeBreaksModal() {
            breaksModal.style.display = 'none';
            selectedEmployeeId = null;
        }

        /**
         * –†–µ–Ω–¥–µ—Ä–∏—Ç —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.
         * @param {Object} employee - –û–±—ä–µ–∫—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.
         */
        function renderBreaksList(employee) {
            breaksList.innerHTML = '';
            
            if (employee.breaks.length === 0) {
                breaksList.innerHTML = '<p style="text-align: center; color: #7f8c8d;">–ü–µ—Ä–µ—Ä—ã–≤–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>';
            }

            employee.breaks.sort((a, b) => a.start.getTime() - b.start.getTime()).forEach((br, index) => {
                const breakItem = document.createElement('div');
                breakItem.className = 'break-item';
                
                const durationMs = br.end.getTime() - br.start.getTime();
                const durationMinutes = Math.round(durationMs / (1000 * 60));

                const breakInfo = document.createElement('span');
                breakInfo.textContent = `${formatTime(br.start)} - ${formatTime(br.end)} (${durationMinutes} –º–∏–Ω)`;

                const breakActions = document.createElement('div');
                breakActions.className = 'break-actions';

                // –ö–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å"
                const removeBtn = document.createElement('button');
                removeBtn.textContent = '–£–¥–∞–ª–∏—Ç—å';
                removeBtn.className = 'clear-data';
                removeBtn.onclick = () => removeBreak(employee.id, index);

                breakActions.appendChild(removeBtn);
                
                breakItem.appendChild(breakInfo);
                breakItem.appendChild(breakActions);
                breaksList.appendChild(breakItem);
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â–µ–µ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ä—ã–≤–æ–≤
            const totalDuration = calculateTotalBreakDuration(employee);
            totalBreakTimeElement.textContent = `–û–±—â–µ–µ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ä—ã–≤–æ–≤: ${totalDuration} –º–∏–Ω`;
        }
        
        /**
         * –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–π –ø–µ—Ä–µ—Ä—ã–≤.
         */
        function addBreak() {
            const employee = employees.find(emp => emp.id === selectedEmployeeId);
            if (!employee) return;
            
            const startStr = breakStartInput.value;
            const durationMinutes = parseInt(breakDurationSelect.value);
            
            if (!startStr) {
                alert('–£–∫–∞–∂–∏—Ç–µ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞.');
                return;
            }

            const breakStart = parseTime(startStr);
            const breakEnd = new Date(breakStart.getTime() + durationMinutes * 60000);

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, —á—Ç–æ –ø–µ—Ä–µ—Ä—ã–≤ –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã —Å–º–µ–Ω—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
            if (!isBreakInShift(breakStart, breakEnd, employee.shiftStart, employee.shiftEnd)) {
                alert('–ü–µ—Ä–µ—Ä—ã–≤ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ —Ä–∞–º–∫–∞—Ö —Å–º–µ–Ω—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.');
                return;
            }
            
            const newBreak = { start: breakStart, end: breakEnd };
            employee.breaks.push(newBreak);
            
            renderBreaksList(employee); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫
            renderEmployees(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫
        }

        /**
         * –£–¥–∞–ª—è–µ—Ç –ø–µ—Ä–µ—Ä—ã–≤.
         * @param {number} employeeId - ID —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.
         * @param {number} breakIndex - –ò–Ω–¥–µ–∫—Å –ø–µ—Ä–µ—Ä—ã–≤–∞ –≤ –º–∞—Å—Å–∏–≤–µ.
         */
        function removeBreak(employeeId, breakIndex) {
            const employee = employees.find(emp => emp.id === employeeId);
            if (!employee) return;

            employee.breaks.splice(breakIndex, 1);
            
            renderBreaksList(employee);
            renderEmployees();
        }


        // --- –õ–æ–≥–∏–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞/–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è ---
        
        /**
         * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTML –¥–ª—è PDF-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è.
         */
        function generatePdfContent() {
             // 1. –°—á–∏—Ç–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
            const conflictMap = calculateBreakConflicts();
            
            // 2. –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
            employees.forEach(employee => {
                const employeeRow = document.createElement('div');
                employeeRow.className = 'pdf-employee-row';
                
                // --- –ö–æ–ª–æ–Ω–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–µ (Sticky) ---
                const infoDiv = document.createElement('div');
                infoDiv.className = 'pdf-employee-info';
                
                const nameSpan = document.createElement('div');
                nameSpan.style.fontWeight = '600';
                nameSpan.textContent = employee.name;
                
                const positionSpan = document.createElement('div');
                positionSpan.style.fontSize = '0.9em';
                positionSpan.textContent = employee.position;
                
                const workHoursSpan = document.createElement('div');
                workHoursSpan.style.fontSize = '0.9em';
                workHoursSpan.style.color = '#3498db';
                workHoursSpan.textContent = `${formatTime(employee.shiftStart)} - ${formatTime(employee.shiftEnd)}`;

                const totalBreaksSpan = document.createElement('div');
                totalBreaksSpan.style.fontSize = '0.9em';
                totalBreaksSpan.style.color = '#e74c3c';
                const totalDuration = calculateTotalBreakDuration(employee);
                totalBreaksSpan.textContent = `–ü–µ—Ä–µ—Ä—ã–≤—ã: ${totalDuration} –º–∏–Ω`;

                infoDiv.appendChild(nameSpan);
                infoDiv.appendChild(positionSpan);
                infoDiv.appendChild(workHoursSpan);
                infoDiv.appendChild(totalBreaksSpan);
                
                employeeRow.appendChild(infoDiv);

                // --- –Ø—á–µ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ ---
                const cellsDiv = document.createElement('div');
                cellsDiv.className = 'pdf-time-cells';
                
                const totalMinutes = (workEnd.getTime() - workStart.getTime()) / (1000 * 60);
                const numSlots = totalMinutes / 15;
                let currentTime = new Date(workStart);
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å–º–µ–Ω—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (—É—á–∏—Ç—ã–≤–∞—è –Ω–æ—á–Ω—ã–µ —Å–º–µ–Ω—ã)
                const employeeShiftEnd = new Date(employee.shiftEnd);
                if (employeeShiftEnd.getTime() <= employee.shiftStart.getTime()) {
                    employeeShiftEnd.setDate(employeeShiftEnd.getDate() + 1);
                }


                for (let i = 0; i < numSlots; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'pdf-time-cell';

                    const intervalStart = new Date(currentTime);
                    currentTime.setMinutes(currentTime.getMinutes() + 15);
                    const intervalEnd = new Date(currentTime);
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞: –†–∞–±–æ—á–µ–µ –ª–∏ –≤—Ä–µ–º—è?
                    const isWorking = intervalStart.getTime() >= employee.shiftStart.getTime() && 
                                      intervalEnd.getTime() <= employeeShiftEnd.getTime();
                    
                    if (isWorking) {
                        cell.classList.add('working-time-cell');
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞: –ü–µ—Ä–µ—Ä—ã–≤ –ª–∏?
                    let isBreak = false;
                    for (const breakItem of employee.breaks) {
                        if (intervalStart.getTime() < breakItem.end.getTime() && intervalEnd.getTime() > breakItem.start.getTime()) {
                            isBreak = true;
                            break;
                        }
                    }
                    
                    if (isBreak) {
                        cell.classList.add('break');
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞: –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ª–∏?
                    if (conflictMap[intervalStart.getTime()] && conflictMap[intervalStart.getTime()].count > 1) {
                         // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—á–∞—Å—Ç–≤—É–µ—Ç –ª–∏ –¥–∞–Ω–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –≤ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ –≤ —ç—Ç–æ–º —Å–ª–æ—Ç–µ
                        if (conflictMap[intervalStart.getTime()].employees.includes(employee.id)) {
                             cell.classList.add('conflict');
                        }
                    }

                    cellsDiv.appendChild(cell);
                }
                
                employeeRow.appendChild(cellsDiv);
                pdfTimelineContainer.appendChild(employeeRow);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ª–µ–≥–µ–Ω–¥—É
            const legendDiv = document.createElement('div');
            legendDiv.className = 'legend';
            legendDiv.style.justifyContent = 'flex-start'; // –î–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏ –≤ PDF
            
            const legendItems = [
                { color: '#3498db', text: '–†–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è' },
                { color: '#f0f8ff', text: '–ù–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è' },
                { color: '#e74c3c', text: '–ü–µ—Ä–µ—Ä—ã–≤' },
                { color: '#c0392b', text: '–ö–æ–Ω—Ñ–ª–∏–∫—Ç (2+)' }
            ];
            
            legendItems.forEach(item => {
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                legendItem.style.fontSize = '0.7rem';
                
                const colorDiv = document.createElement('div');
                colorDiv.className = 'legend-color';
                colorDiv.style.background = item.color;
                if (item.text.includes('–ö–æ–Ω—Ñ–ª–∏–∫—Ç')) {
                    colorDiv.style.border = '1px dashed #fff';
                } else {
                    colorDiv.style.border = '1px solid #ddd';
                }
                
                const textSpan = document.createElement('span');
                textSpan.textContent = item.text;
                
                legendItem.appendChild(colorDiv);
                legendItem.appendChild(textSpan);
                legendDiv.appendChild(legendItem);
            });
            
            pdfTimelineContainer.appendChild(legendDiv);
        }
        
        /**
         * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–µ—Ä–µ–¥ —ç–∫—Å–ø–æ—Ä—Ç–æ–º/–æ—Ç–ø—Ä–∞–≤–∫–æ–π.
         * @param {string} action - 'telegram', 'whatsapp', 'pdf', 'image'.
         */
        function showPreview(action) {
            currentAction = action;
            let text = '';
            
            switch(action) {
                case 'telegram':
                    text = '–í—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –≥—Ä–∞—Ñ–∏–∫–æ–º –≤ Telegram? –ë—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.';
                    break;
                case 'whatsapp':
                    text = '–í—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –≥—Ä–∞—Ñ–∏–∫–æ–º –≤ WhatsApp? –ë—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.';
                    break;
                case 'pdf':
                    text = '–í—ã —Ö–æ—Ç–∏—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫ –≤ PDF? –§–∞–π–ª –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω.';
                    break;
                case 'image':
                    text = '–í—ã —Ö–æ—Ç–∏—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫ –≤ –≤–∏–¥–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (PNG)? –§–∞–π–ª –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω.';
                    break;
            }
            
            previewText.textContent = text;
            previewModal.style.display = 'flex';
        }
        
        /**
         * –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.
         */
        function closePreviewModal() {
            previewModal.style.display = 'none';
            currentAction = null;
            // –°–±—Ä–æ—Å –∫–Ω–æ–ø–∫–∏
            confirmActionButton.textContent = '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å';
            confirmActionButton.disabled = false;
            confirmActionButton.style.background = '#3498db';
        }

        /**
         * –í—ã–ø–æ–ª–Ω—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–∞/–æ—Ç–ø—Ä–∞–≤–∫–∏.
         * @param {string} action - 'telegram', 'whatsapp', 'pdf', 'image'.
         * @param {HTMLButtonElement} button - –ö–Ω–æ–ø–∫–∞, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å.
         */
        async function shareTo(action, button) {
            
            // 1. –û—Ç–∫—Ä—ã–≤–∞–µ–º PDF View –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
            pdfView.style.display = 'flex';
            pdfTimelineContainer.innerHTML = '';
            generatePdfTimelineHeaders(); // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
            generatePdfContent(); // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—É
            const now = new Date();
            const dateStr = now.toLocaleDateString('ru-RU', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            pdfDateElement.textContent = `–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ${dateStr}`;

            // 2. –ñ–¥–µ–º, —á—Ç–æ–±—ã –±—Ä–∞—É–∑–µ—Ä —É—Å–ø–µ–ª –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å.
            await new Promise(resolve => setTimeout(resolve, 50));
            
            const targetElement = document.getElementById('pdfView'); // –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º –≤–µ—Å—å PDF View
            
            try {
                const canvas = await html2canvas(targetElement, {
                    scale: 2, // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∞ –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
                    useCORS: true,
                    scrollX: -window.scrollX,
                    scrollY: -window.scrollY,
                    windowWidth: targetElement.scrollWidth,
                    windowHeight: targetElement.scrollHeight
                });
                
                if (action === 'pdf') {
                    exportToPDF(canvas);
                } else {
                    exportToImage(canvas, action); // –î–ª—è image, telegram, whatsapp
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è/PDF:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ–∞–π–ª–∞.');
            } finally {
                // 3. –ó–∞–∫—Ä—ã–≤–∞–µ–º PDF View –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                pdfView.style.display = 'none';
                button.textContent = '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å';
                button.disabled = false;
                button.style.background = '#3498db';
                closePreviewModal();
            }
        }
        
        /**
         * –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –≥—Ä–∞—Ñ–∏–∫ –≤ PDF.
         * @param {HTMLCanvasElement} canvas - Canvas —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –≥—Ä–∞—Ñ–∏–∫–∞.
         */
        function exportToPDF(canvas) {
            // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ jsPDF
            const { jsPDF } = window.jspdf;
            
            // –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–æ–≤
            const imgData = canvas.toDataURL('image/png');
            const imgWidth = 210; // A4 width in mm
            const pageHeight = 295; // A4 height in mm
            const imgHeight = canvas.height * imgWidth / canvas.width;
            let heightLeft = imgHeight;
            
            // –°–æ–∑–¥–∞–Ω–∏–µ PDF
            const pdf = new jsPDF('p', 'mm', 'a4');
            let position = 0;

            pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;

            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü, –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª–∏–Ω–Ω—ã–π
            while (heightLeft >= 0) {
                position = heightLeft - imgHeight;
                pdf.addPage();
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
            }

            const now = new Date();
            const dateStr = now.toISOString().slice(0, 10);
            pdf.save(`–≥—Ä–∞—Ñ–∏–∫_–ø–µ—Ä–µ—Ä—ã–≤–æ–≤_${dateStr}.pdf`);
        }
        
        /**
         * –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –≥—Ä–∞—Ñ–∏–∫ –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (PNG) –∏–ª–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ —à–∞—Ä–∏–Ω–≥–∞.
         * @param {HTMLCanvasElement} canvas - Canvas —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –≥—Ä–∞—Ñ–∏–∫–∞.
         * @param {string} action - 'image', 'telegram', 'whatsapp'.
         */
        function exportToImage(canvas, action) {
            const now = new Date();
            const dateStr = now.toISOString().slice(0, 10);
            const fileName = `–≥—Ä–∞—Ñ–∏–∫_–ø–µ—Ä–µ—Ä—ã–≤–æ–≤_${dateStr}.png`;
            
            canvas.toBlob(function(blob) {
                if (navigator.share && (action === 'telegram' || action === 'whatsapp')) {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º Web Share API –¥–ª—è Telegram/WhatsApp
                    const file = new File([blob], fileName, { type: 'image/png' });
                    
                    navigator.share({
                        files: [file],
                        title: '–ì—Ä–∞—Ñ–∏–∫ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤',
                        text: '–ì—Ä–∞—Ñ–∏–∫ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.'
                    }).catch((error) => {
                        console.log('–û—à–∏–±–∫–∞ Web Share API:', error);
                        // –ï—Å–ª–∏ —à–∞—Ä–∏–Ω–≥ –Ω–µ —É–¥–∞–ª—Å—è, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Å–∫–∞—á–∞—Ç—å
                        downloadFile(blob, fileName);
                    });
                    
                } else {
                    // –î–ª—è 'image' –∏–ª–∏ –µ—Å–ª–∏ Web Share API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
                    downloadFile(blob, fileName);
                }
            }, 'image/png');
        }

        /**
         * –°–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∞–π–ª.
         * @param {Blob} blob - –û–±—ä–µ–∫—Ç Blob —Å –¥–∞–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞.
         * @param {string} fileName - –ò–º—è —Ñ–∞–π–ª–∞.
         */
        function downloadFile(blob, fileName) {
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }
        
        /**
         * –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ JSON.
         */
        function exportToJSON() {
            const dataToExport = {
                shiftStart: shiftStartInput.value,
                shiftEnd: shiftEndInput.value,
                employees: employees.map(emp => ({
                    ...emp,
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º Date –æ–±—Ä–∞—Ç–Ω–æ –≤ ISO-—Å—Ç—Ä–æ–∫—É –¥–ª—è JSON
                    shiftStart: formatTime(emp.shiftStart), 
                    shiftEnd: formatTime(emp.shiftEnd),
                    breaks: emp.breaks.map(br => ({
                        start: br.start.toISOString(),
                        end: br.end.toISOString()
                    }))
                }))
            };
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(dataToExport, null, 2));
            const downloadAnchorNode = document.createElement('a');
            const now = new Date();
            const dateStr = now.toISOString().slice(0, 10);
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", `employee_breaks_data_${dateStr}.json`);
            document.body.appendChild(downloadAnchorNode); 
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        /**
         * –ó–∞–ø—É—Å–∫–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –∏–º–ø–æ—Ä—Ç–∞ JSON.
         */
        function importJSON() {
            jsonFileInput.click();
        }
        
        /**
         * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π JSON-—Ñ–∞–π–ª.
         */
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data && data.employees) {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ç–∞–π–º–ª–∞–π–Ω
                        if (data.shiftStart && data.shiftEnd) {
                            shiftStartInput.value = data.shiftStart;
                            shiftEndInput.value = data.shiftEnd;
                        } else {
                            // –ï—Å–ª–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ
                            shiftStartInput.value = '09:45';
                            shiftEndInput.value = '22:45';
                        }
                        
                        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º—è –æ–±—Ä–∞—Ç–Ω–æ –≤ Date
                        employees = data.employees.map(emp => {
                            const shiftStart = parseTime(emp.shiftStart);
                            let shiftEnd = parseTime(emp.shiftEnd);
                            
                            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –¥–ª—è –Ω–æ—á–Ω–æ–π —Å–º–µ–Ω—ã
                            if (shiftEnd.getTime() <= shiftStart.getTime()) {
                                shiftEnd.setDate(shiftEnd.getDate() + 1);
                            }
                            
                            return {
                                ...emp,
                                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ Date
                                shiftStart: shiftStart,
                                shiftEnd: shiftEnd,
                                breaks: emp.breaks.map(br => ({
                                    start: new Date(br.start),
                                    end: new Date(br.end)
                                }))
                            };
                        });
                        
                        // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º
                        updateShiftTimes(true);
                        alert('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã.');
                    } else {
                        alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON-—Ñ–∞–π–ª–∞.');
                    }
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: ' + error.message);
                }
            };
            reader.readAsText(file);
        }
        
        /**
         * –ö–æ–ø–∏—Ä—É–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞.
         * @param {string} type - 'brief' (–∫—Ä–∞—Ç–∫–æ–µ) –∏–ª–∏ 'detailed' (–¥–µ—Ç–∞–ª—å–Ω–æ–µ).
         */
        function copySchedule(type) {
            let scheduleText = '';
            
            const dateStr = new Date().toLocaleDateString('ru-RU', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            scheduleText += `--- –ì—Ä–∞—Ñ–∏–∫ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ –Ω–∞ ${dateStr} ---\n\n`;
            
            employees.forEach(employee => {
                const totalDuration = calculateTotalBreakDuration(employee);
                
                scheduleText += `* ${employee.name} (${employee.position}) - ${formatTime(employee.shiftStart)} - ${formatTime(employee.shiftEnd)} (–í—Å–µ–≥–æ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤: ${totalDuration} –º–∏–Ω)\n`;

                if (type === 'detailed' && employee.breaks.length > 0) {
                    employee.breaks.sort((a, b) => a.start.getTime() - b.start.getTime()).forEach(br => {
                        const durationMs = br.end.getTime() - br.start.getTime();
                        const durationMinutes = Math.round(durationMs / (1000 * 60));
                        scheduleText += `  - –ü–µ—Ä–µ—Ä—ã–≤: ${formatTime(br.start)} - ${formatTime(br.end)} (${durationMinutes} –º–∏–Ω)\n`;
                    });
                } else if (type === 'detailed' && employee.breaks.length === 0) {
                     scheduleText += `  - –ù–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ—Ä—ã–≤–æ–≤.\n`;
                }
            });
            
            navigator.clipboard.writeText(scheduleText).then(() => {
                alert(`–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ (${type === 'brief' ? '–∫—Ä–∞—Ç–∫–æ–µ' : '–¥–µ—Ç–∞–ª—å–Ω–æ–µ'}) —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞.`);
            }).catch(err => {
                console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å).');
            });
        }


        // --- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–ó–∞–≥—Ä—É–∑–∫–∞ –≤ LocalStorage ---

        /**
         * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ LocalStorage.
         */
        function saveToLocalStorage() {
            const dataToSave = {
                shiftStart: shiftStartInput.value,
                shiftEnd: shiftEndInput.value,
                employees: employees.map(emp => ({
                    ...emp,
                    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º Date –≤ ISO-—Å—Ç—Ä–æ–∫—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è
                    shiftStart: emp.shiftStart.toISOString(), 
                    shiftEnd: emp.shiftEnd.toISOString(),
                    breaks: emp.breaks.map(br => ({
                        start: br.start.toISOString(),
                        end: br.end.toISOString()
                    }))
                }))
            };
            localStorage.setItem('employeeBreakData', JSON.stringify(dataToSave));
        }

        /**
         * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ LocalStorage.
         */
        function loadFromLocalStorage() {
            const data = JSON.parse(localStorage.getItem('employeeBreakData'));
            if (data) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ç–∞–π–º–ª–∞–π–Ω
                if (data.shiftStart && data.shiftEnd) {
                    shiftStartInput.value = data.shiftStart;
                    shiftEndInput.value = data.shiftEnd;
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º—è –æ–±—Ä–∞—Ç–Ω–æ –≤ Date
                employees = data.employees.map(emp => {
                    const shiftStart = new Date(emp.shiftStart);
                    const shiftEnd = new Date(emp.shiftEnd);
                    
                    return {
                        ...emp,
                        shiftStart: shiftStart,
                        shiftEnd: shiftEnd,
                        breaks: emp.breaks.map(br => ({
                            start: new Date(br.start),
                            end: new Date(br.end)
                        }))
                    };
                });
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–∞–π–º–ª–∞–π–Ω
                updateShiftTimes(true);
            } else {
                 // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–æ—Å—Ç–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–∞–π–º–ª–∞–π–Ω —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
                updateShiftTimes(true);
            }
        }


        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π ---
        document.addEventListener('DOMContentLoaded', () => {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –∏ –∏–Ω–ø—É—Ç–æ–≤
            addEmployeeBtn.addEventListener('click', addEmployee);
            addBreakBtn.addEventListener('click', addBreak);
            saveEmployeeEditBtn.addEventListener('click', saveEmployeeEdit);
            removeEmployeeBtn.addEventListener('click', removeEmployee);
            pdfCloseBtn.addEventListener('click', () => {
                pdfView.style.display = 'none';
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é
            dataMenuBtn.addEventListener('click', () => {
                dataDropdown.classList.toggle('show');
            });
            document.addEventListener('click', (event) => {
                if (!dataMenuBtn.contains(event.target) && !dataDropdown.contains(event.target)) {
                    dataDropdown.classList.remove('show');
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–º–ø–æ—Ä—Ç–∞ —Ñ–∞–π–ª–∞
            jsonFileInput.addEventListener('change', handleFileSelect);

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
            shiftStartInput.addEventListener('change', updateShiftTimes);
            shiftEndInput.addEventListener('change', updateShiftTimes);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
            clearDataBtn.addEventListener('click', () => {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ?')) {
                    localStorage.removeItem('employeeBreakData');
                    employees = [];
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º –∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º
                    shiftStartInput.value = '09:45'; 
                    shiftEndInput.value = '22:45'; 
                    updateShiftTimes(true); 
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞)
            confirmActionButton.onclick = function() {
                this.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞...';
                this.disabled = true;
                this.style.background = '#f39c12';
                
                const button = this;

                // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã –±—Ä–∞—É–∑–µ—Ä —É—Å–ø–µ–ª –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
                setTimeout(() => {
                    shareTo(currentAction, button);
                }, 10);
            };

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            loadFromLocalStorage();

            // Make functions available globally for onclick attributes
            window.openEditModal = openEditModal;
            window.closeEditModal = closeEditModal;
            window.saveEmployeeEdit = saveEmployeeEdit;
            window.removeEmployee = removeEmployee;
            window.showBreaks = showBreaks;
            window.closeBreaksModal = closeBreaksModal;
            window.removeBreak = removeBreak;
            window.showPreview = showPreview;
            window.closePreviewModal = closePreviewModal;
            window.shareTo = shareTo;
            window.exportToPDF = exportToPDF;
            window.exportToImage = exportToImage;
            window.exportToJSON = exportToJSON;
            window.importJSON = importJSON;
            window.copySchedule = copySchedule;
        });
    </script>
</body>
</html>